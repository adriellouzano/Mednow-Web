// ==========================
// Configura√ß√£o do Prisma Client
generator client {
  provider = "prisma-client-js"
}

// Fonte de dados
datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

// ==========================
// Entidade: Usuario
// Finalidade: Representa todos os usu√°rios do sistema (m√©dicos, pacientes, farmac√™uticos, administradores)
model Usuario {
  id                   String           @id @default(cuid())
  nome                 String
  cpf                  String           @unique
  email                String?
  senhaHash            String

  // üîî Token de notifica√ß√£o push (FCM)
  tokenFCM             String?

  // Relacionamentos
  perfis               PerfilUsuario[]
  alarmesCriados       Alarme[]         @relation("UsuarioAlarmes")
  entregasFeitas       Entrega[]        @relation("UsuarioEntregas")
  prescricoesMedicas   Prescricao[]     @relation("PrescricoesMedico")    // M√©dicos que criaram prescri√ß√µes
  prescricoesRecebidas Prescricao[]     @relation("PrescricoesPaciente")  // Pacientes que receberam prescri√ß√µes

  criadoEm             DateTime         @default(now())
  atualizadoEm         DateTime         @updatedAt
}

// ==========================
// Entidade: PerfilUsuario
// Finalidade: Define o tipo de perfil (m√©dico, paciente, farmac√™utico, admin)
model PerfilUsuario {
  id                String       @id @default(cuid())
  usuarioId         String
  usuario           Usuario      @relation(fields: [usuarioId], references: [id])
  tipo              PerfilTipo

  crm               String?
  crf               String?
  aprovado          Boolean?
  pendenteAprovacao Boolean?

  criadoEm          DateTime     @default(now())
  atualizadoEm      DateTime     @updatedAt
}

// ==========================
// Enum: Tipos poss√≠veis de perfil
enum PerfilTipo {
  medico
  paciente
  farmaceutico
  admin
}

// ==========================
// Entidade: Prescricao
// Finalidade: Armazena os dados de uma prescri√ß√£o m√©dica
// Base legal: Portaria SVS/MS 344/1998, RDC 20/2011
model Prescricao {
  id                 String           @id @default(cuid())
  pacienteId         String
  medicoId           String

  paciente           Usuario          @relation("PrescricoesPaciente", fields: [pacienteId], references: [id])
  medico             Usuario          @relation("PrescricoesMedico", fields: [medicoId], references: [id])

  medicamento        String
  dosagem            String
  frequencia         String
  duracao            String
  observacoes        String?

  tipoMedicamento    TipoMedicamento
  tipoReceituario    String?
  numeroNotificacao  String?
  validadeReceita    DateTime?
  quantidadeVias     Int?
  assinaturaDigital  Boolean?

  alarmes            Alarme[]
  entregas           Entrega[]

  criadoEm           DateTime         @default(now())
  atualizadoEm       DateTime         @updatedAt
}

// ==========================
// Enum: Tipo de Medicamento
enum TipoMedicamento {
  comum
  antibiotico
  controlado
}

// ==========================
// Entidade: Alarme
// Finalidade: Armazena configura√ß√µes reais de alarmes de medica√ß√£o
// Tecnologias: Prisma ORM + integra√ß√£o futura com LocalStorage e FCM
model Alarme {
  id               String     @id @default(cuid())
  prescricaoId     String
  prescricao       Prescricao @relation(fields: [prescricaoId], references: [id])

  horarioInicial   String                     // Ex: "08:00" (formato 24h)
  frequenciaDiaria Int                         // Ex: 2 ‚Üí 2 vezes por dia
  duracaoDias      Int                         // Ex: 3 ‚Üí repetir por 3 dias

  criadoPorId      String
  criadoPor        Usuario    @relation("UsuarioAlarmes", fields: [criadoPorId], references: [id])

  criadoEm         DateTime   @default(now())
  atualizadoEm     DateTime   @updatedAt
}

// ==========================
// Entidade: Entrega
// Finalidade: Registra a entrega de medicamentos na farm√°cia
model Entrega {
  id             String     @id @default(cuid())
  prescricaoId   String
  prescricao     Prescricao @relation(fields: [prescricaoId], references: [id])

  farmaceuticoId String
  farmaceutico   Usuario    @relation("UsuarioEntregas", fields: [farmaceuticoId], references: [id])

  dataEntrega    DateTime
  criadoEm       DateTime   @default(now())
  atualizadoEm   DateTime   @updatedAt
}

// ==========================
// Entidade: Medicamento (Futura)
// Finalidade: Cadastro b√°sico de medicamentos
model Medicamento {
  id             String    @id @default(cuid())
  nome           String
  principioAtivo String
  interacoes     String?

  criadoEm       DateTime  @default(now())
  atualizadoEm   DateTime  @updatedAt
}
