// ==========================
// Configuração do Prisma Client
generator client {
  provider = "prisma-client-js"
}

// Fonte de dados
datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

// ==========================
// Entidade: Usuario
// Finalidade: Representa todos os usuários do sistema (médicos, pacientes, farmacêuticos, administradores)
model Usuario {
  id                   String           @id @default(cuid())
  nome                 String
  cpf                  String           @unique
  email                String?
  senhaHash            String
  tokenFCM             String?
  perfis               PerfilUsuario[]
  alarmesCriados       Alarme[]         @relation("UsuarioAlarmes")
  entregasFeitas       Entrega[]        @relation("UsuarioEntregas")
  prescricoesMedicas   Prescricao[]     @relation("PrescricoesMedico")    
  prescricoesRecebidas Prescricao[]     @relation("PrescricoesPaciente")  

  criadoEm             DateTime         @default(now())
  atualizadoEm         DateTime         @updatedAt
}


model PerfilUsuario {
  id                String       @id @default(cuid())
  usuarioId         String
  usuario           Usuario      @relation(fields: [usuarioId], references: [id])
  tipo              PerfilTipo

  crm               String?
  crf               String?
  aprovado          Boolean?
  pendenteAprovacao Boolean?

  criadoEm          DateTime     @default(now())
  atualizadoEm      DateTime     @updatedAt
}

enum PerfilTipo {
  medico
  paciente
  farmaceutico
  admin
}

model Prescricao {
  id                 String           @id @default(cuid())
  pacienteId         String
  medicoId           String

  paciente           Usuario          @relation("PrescricoesPaciente", fields: [pacienteId], references: [id])
  medico             Usuario          @relation("PrescricoesMedico", fields: [medicoId], references: [id])

  medicamento        String
  dosagem            String
  frequencia         String
  duracao            String
  observacoes        String?

  tipoMedicamento    TipoMedicamento
  tipoReceituario    String?
  numeroNotificacao  String?
  validadeReceita    DateTime?
  quantidadeVias     Int?
  assinaturaDigital  Boolean?

  alarmes            Alarme[]
  entregas           Entrega[]

  criadoEm           DateTime         @default(now())
  atualizadoEm       DateTime         @updatedAt
}

enum TipoMedicamento {
  comum
  antibiotico
  controlado
}

model Alarme {
  id               String     @id @default(cuid())
  prescricaoId     String
  prescricao       Prescricao @relation(fields: [prescricaoId], references: [id])

  horarioInicial   String                     
  frequenciaDiaria Int                         
  duracaoDias      Int                         

  criadoPorId      String
  criadoPor        Usuario    @relation("UsuarioAlarmes", fields: [criadoPorId], references: [id])

  criadoEm         DateTime   @default(now())
  atualizadoEm     DateTime   @updatedAt
}

model Entrega {
  id             String     @id @default(cuid())
  prescricaoId   String
  prescricao     Prescricao @relation(fields: [prescricaoId], references: [id])

  farmaceuticoId String
  farmaceutico   Usuario    @relation("UsuarioEntregas", fields: [farmaceuticoId], references: [id])

  dataEntrega    DateTime
  criadoEm       DateTime   @default(now())
  atualizadoEm   DateTime   @updatedAt
}

model Medicamento {
  id             String    @id @default(cuid())
  nome           String
  principioAtivo String
  interacoes     String?

  criadoEm       DateTime  @default(now())
  atualizadoEm   DateTime  @updatedAt
}
